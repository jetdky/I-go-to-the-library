# “我去图书馆” 抢座脚本 2018-10-5

最近图书馆采用了“我去图书馆”座位管理系统，而这个座位管理系统与我未实现的某个项目高度相似。为了技术的尊严，决定用python写一个小脚本来抢座。经过一番搜索后发现知乎“二叉树”曾经写过一个类似的项目并且开源到了github。也还好“我去图书馆”的数据包到现在还没有加密，于是我基于他的代码，成功敲出了这个抢座脚本。现在也把我的代码开源，供大家一起研究。
********************
## 所用工具
* fiddler 抓包工具
* adb 工具模拟点击
* C语言 获得重要参数
* python 实现预约功能
* .bat 实现自动化
## 实现过程     
1. 使用fiddler抓取公众号座位选择页面，获得所需座位的行、列和座位号以及自习室信息，便于后续使用。
2. 预约前半个小时（实测一个小时也可以），使用adb连接 android手机，模拟点击“常用座位”按钮。此时虽没有预约成功，但通过fiddler抓包发现已经向服务器发送了一个get请求。
2. 通过配置fidder将该get请求的请求体的记录到文件保存到本地
3. 使用C语言获得相关参数如WECHATSESS_ID 等（详见代码注释）
4. 在脚本中填上自己想预定的自习室和座位号，以及自习室开放预定的时间等   
5. 准点模拟发送get请求即可
6. 以上步骤在windows下借用.bat和定时任务即可实现准点自动执行座位预约
## 写在最后
整个流程走下来，猛然发觉为何不直接使用adb工具在指定时刻模拟点击预约按钮实现预约呢？一番测试后发现adb工具并不能准确准时预定到座位，不由得大松一口气。 
********************   
>**2020.06.27**
时隔两年再看，其实使用正则就可以读出许多参数，C语言读取文件的步骤可以省略的。